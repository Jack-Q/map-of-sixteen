<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="baidu-site-verification" content="tKs9kOOFVn" />
    <link href="favicon.ico" type="image/x-icon" rel="icon">
    <link href="favicon.ico" type="image/x-icon" rel="shortcut icon">
    <title>Map of Sixteen</title>
    <script src="js/lib/jquery.js"></script>
    <script src="js/lib/raphael.js"></script>
    <style>
        html,body,div{
            padding:0;
            margin:0;
        }
    </style>
</head>
<body>
    <div class="ctrl-box"></div>
    <div class="maps-box">
        <div class="maps-pos"></div>
        <div class="maps-china" id="maps-china"></div>
    </div>
    <div class="info-box"></div>
    <div class="tips-box"></div>
    <div class="mask-loading"></div>
    <script>
        $( function () {
            var $window = $( window ),
                 width = $window.width(), height = $( window ).height(),
                $map = $( 'div#maps-china' );
            $map.css( { 'width': width + 'px', 'height': height + 'px' } );
            var paper = Raphael( document.getElementById( "maps-china" ), width, height, function () {
                var m = this;
                m.rect( 0, 0, width, height, 0 ).attr( {
                    stroke: "none",
                    fill: "0-#9bb7cb-#adc8da"
                } );
            } );
            function i() {
                Raphael( 10, 10, 1000, 400, function () {
                    var r = this;
                    r.rect( 0, 0, 1000, 400, 10 ).attr( {
                        stroke: "none",
                        fill: "0-#9bb7cb-#adc8da"
                    } );
                    var over = function () {
                        this.c = this.c || this.attr( "fill" );
                        this.stop().animate( { fill: "#bacabd" }, 500 );
                    },
                        out = function () {
                            this.stop().animate( { fill: this.c }, 500 );
                        };
                    r.setStart();
                    var hue = Math.random();
                    for ( var country in worldmap.shapes ) {
                        // var c = Raphael.hsb(Math.random(), .5, .75);
                        // var c = Raphael.hsb(.11, .5, Math.random() * .25 - .25 + .75);
                        r.path( worldmap.shapes[country] ).attr( { stroke: "#ccc6ae", fill: "#f0efeb", "stroke-opacity": 0.25 } );
                    }
                    var world = r.setFinish();
                    world.hover( over, out );
                    // world.animate({fill: "#666", stroke: "#666"}, 2000);
                    world.getXY = function ( lat, lon ) {
                        return {
                            cx: lon * 2.6938 + 465.4,
                            cy: lat * -2.6938 + 227.066
                        };
                    };
                    world.getLatLon = function ( x, y ) {
                        return {
                            lat: ( y - 227.066 ) / -2.6938,
                            lon: ( x - 465.4 ) / 2.6938
                        };
                    };
                    var latlonrg = /(\d+(?:\.\d+)?)[\xb0\s]?\s*(?:(\d+(?:\.\d+)?)['\u2019\u2032\s])?\s*(?:(\d+(?:\.\d+)?)["\u201d\u2033\s])?\s*([SNEW])?/i;
                    world.parseLatLon = function ( latlon ) {
                        var m = String( latlon ).split( latlonrg ),
                            lat = m && +m[1] + ( m[2] || 0 ) / 60 + ( m[3] || 0 ) / 3600;
                        if ( m[4].toUpperCase() == "S" ) {
                            lat = -lat;
                        }
                        var lon = m && +m[6] + ( m[7] || 0 ) / 60 + ( m[8] || 0 ) / 3600;
                        if ( m[9].toUpperCase() == "W" ) {
                            lon = -lon;
                        }
                        return this.getXY( lat, lon );
                    };

                    try {
                        navigator.geolocation && navigator.geolocation.getCurrentPosition( function ( pos ) {
                            r.circle().attr( { fill: "none", stroke: "#f00", r: 5 } ).attr( world.getXY( pos.coords.latitude, pos.coords.longitude ) );
                        } );
                    } catch ( e ) { }
                    var frm = document.getElementById( "latlon-form" ),
                        dot = r.circle().attr( { fill: "r#FE7727:50-#F57124:100", stroke: "#fff", "stroke-width": 2, r: 0 } ),
                        // dot2 = r.circle().attr({stroke: "#000", r: 0}),
                        ll = document.getElementById( "latlon" ),
                        cities = document.getElementById( "cities" );
                    frm.onsubmit = function () {
                        var attr = world.parseLatLon( ll.value );
                        attr.r = 0;
                        dot.stop().attr( attr ).animate( { r: 5 }, 1000, "elastic" );
                        // dot2.stop().attr(attr).animate({r: 10}, 1000, "elastic");
                        return false;
                    };
                    cities.onclick = function ( e ) {
                        e = e || window.event;
                        var target = e.target || e.srcElement || document;
                        if ( target.tagName == "A" ) {
                            var txt = decodeURIComponent( target.href.substring( target.href.indexOf( "#" ) + 1 ) ),
                                attr = world.parseLatLon( txt );
                            ll.value = txt;
                            attr.r = 0;
                            dot.stop().attr( attr ).animate( { r: 5 }, 1000, "elastic" );
                            // dot2.stop().attr(attr).animate({r: 10}, 1000, "elastic");
                            return false;
                        }
                    };
                } );

            }
        } );
    </script>
</body>
</html>
